
{% extends "base.html" %}

{% block title %}{{ product.title }} - SmartShop{% endblock %}

{% block content %}
<div class="container mt-4">
  <!-- –•–ª–µ–±–Ω—ã–µ –∫—Ä–æ—à–∫–∏ -->
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="{{ url_for('index') }}">–ì–æ–ª–æ–≤–Ω–∞</a></li>
      <li class="breadcrumb-item active" aria-current="page">{{ product.title }}</li>
    </ol>
  </nav>

  <div class="row">
    <!-- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
    <div class="col-md-6">
      <div class="product-image-container">
        <img src="{{ product.image_url }}" class="img-fluid rounded shadow" alt="{{ product.title }}" style="width: 100%; max-height: 500px; object-fit: contain;">
      </div>
    </div>

    <!-- –û—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
    <div class="col-md-6">
      <div class="product-info">
        <h1 class="h3 mb-3">{{ product.title }}</h1>
        
        <!-- –¶–µ–Ω–∞ -->
        <div class="price-section mb-4">
          <h2 class="text-success fw-bold mb-0">{{ '{:.0f}'.format(product.price) if product.price == product.price|int else '{:.2f}'.format(product.price) }} –≥—Ä–Ω
</h2>
        </div>

        <!-- –ö—Ä–∞—Ç–∫–∏–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
        <div class="quick-specs mb-4">
          <h5>–û—Å–Ω–æ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:</h5>
          <ul class="list-unstyled">
            {% if product.brand %}
            <li><strong>–ë—Ä–µ–Ω–¥:</strong> {{ product.brand }}</li>
            {% endif %}
            {% if product.os %}
            <li><strong>–û–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞:</strong> {{ product.os }}</li>
            {% endif %}
            {% if product.screen_size %}
            <li><strong>–†–æ–∑–º—ñ—Ä –µ–∫—Ä–∞–Ω—É:</strong> {{ product.screen_size }}</li>
            {% endif %}
            {% if product.ram %}
            <li><strong>–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–º'—è—Ç—å:</strong> {{ product.ram }}</li>
            {% endif %}
            {% if product.rom %}
            <li><strong>–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–∞–º'—è—Ç—å:</strong> {{ product.rom }}</li>
            {% endif %}
          </ul>
        </div>

        <!-- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π -->
        <div class="action-buttons mb-4">
          <div class="d-flex gap-3">
            <!-- –ö–Ω–æ–ø–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É -->
            <button class="btn btn-primary btn-lg flex-grow-1 cart-btn" 
                    data-product-id="{{ product.id }}"
                    {% if in_cart %}disabled{% endif %}>
              {% if in_cart %}
                üõí –í–∂–µ –≤ –∫–æ—à–∏–∫—É
              {% else %}
                üõí –î–æ–¥–∞—Ç–∏ –¥–æ –∫–æ—à–∏–∫–∞
              {% endif %}
            </button>
            
            <!-- –ö–Ω–æ–ø–∫–∞ –≤–∏—à–ª–∏—Å—Ç–∞ -->
            <button class="btn btn-outline-danger btn-lg wishlist-btn" 
                    data-product-id="{{ product.id }}"
                    {% if in_wishlist %}disabled{% endif %}>
              {% if in_wishlist %}
                ‚ù§Ô∏è –í –≤—ñ—à–ª–∏—Å—Ç—ñ
              {% else %}
                ‚ù§Ô∏è –î–æ –≤—ñ—à–ª–∏—Å—Ç—É
              {% endif %}
            </button>
          </div>
        </div>

        <!-- –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å -->
        <div class="availability mb-3">
          <span class="badge bg-success fs-6">‚úÖ –í –Ω–∞—è–≤–Ω–æ—Å—Ç—ñ</span>
        </div>
      </div>
    </div>
  </div>

  <!-- –û–ø–∏—Å–∞–Ω–∏–µ —Ç–æ–≤–∞—Ä–∞ -->
  {% if product.description %}
  <div class="row mt-5">
    <div class="col-12">
      <div class="product-description">
        <h3>–û–ø–∏—Å —Ç–æ–≤–∞—Ä—É</h3>
        <div class="card">
          <div class="card-body">
            <p class="card-text">{{ product.description }}</p>
          </div>
        </div>
      </div>
    </div>
  </div>
  {% endif %}

  <!-- –î–µ—Ç–∞–ª—å–Ω—ã–µ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏ -->
  <div class="row mt-5">
    <div class="col-12">
      <div class="specifications">
        <h3>–ü–æ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h3>
        <div class="card">
          <div class="card-body">
            <div class="row">
              <!-- –û—Å–Ω–æ–≤–Ω—ã–µ -->
              <div class="col-md-6">
                <h5 class="text-primary">üì± –û—Å–Ω–æ–≤–Ω—ñ —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏</h5>
                <table class="table table-sm">
                  {% if product.brand %}
                  <tr><td><strong>–ë—Ä–µ–Ω–¥</strong></td><td>{{ product.brand }}</td></tr>
                  {% endif %}
                  {% if product.os %}
                  <tr><td><strong>–û–ø–µ—Ä–∞—Ü—ñ–π–Ω–∞ —Å–∏—Å—Ç–µ–º–∞</strong></td><td>{{ product.os }}</td></tr>
                  {% endif %}
                  {% if product.release_date %}
                  <tr><td><strong>–î–∞—Ç–∞ –≤–∏—Ö–æ–¥—É</strong></td><td>{{ product.release_date }}</td></tr>
                  {% endif %}
                  {% if product.color %}
                  <tr><td><strong>–ö–æ–ª—ñ—Ä</strong></td><td>{{ product.color }}</td></tr>
                  {% endif %}
                </table>

                <h5 class="text-primary mt-4">üì∫ –î–∏—Å–ø–ª–µ–π</h5>
                <table class="table table-sm">
                  {% if product.screen_size %}
                  <tr><td><strong>–†–æ–∑–º—ñ—Ä –µ–∫—Ä–∞–Ω—É</strong></td><td>{{ product.screen_size }}</td></tr>
                  {% endif %}
                  {% if product.resolution %}
                  <tr><td><strong>–†–æ–∑–¥—ñ–ª—å–Ω–∞ –∑–¥–∞—Ç–Ω—ñ—Å—Ç—å</strong></td><td>{{ product.resolution }}</td></tr>
                  {% endif %}
                  {% if product.screen_type %}
                  <tr><td><strong>–¢–∏–ø –µ–∫—Ä–∞–Ω—É</strong></td><td>{{ product.screen_type }}</td></tr>
                  {% endif %}
                  {% if product.refresh_rate %}
                  <tr><td><strong>–ß–∞—Å—Ç–æ—Ç–∞ –æ–Ω–æ–≤–ª–µ–Ω–Ω—è</strong></td><td>{{ product.refresh_rate }}</td></tr>
                  {% endif %}
                </table>

                <h5 class="text-primary mt-4">‚öôÔ∏è –ü—Ä–æ–¥—É–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å</h5>
                <table class="table table-sm">
                  {% if product.cpu %}
                  <tr><td><strong>–ü—Ä–æ—Ü–µ—Å–æ—Ä</strong></td><td>{{ product.cpu }}</td></tr>
                  {% endif %}
                  {% if product.gpu %}
                  <tr><td><strong>–ì—Ä–∞—Ñ—ñ—á–Ω–∏–π –ø—Ä–æ—Ü–µ—Å–æ—Ä</strong></td><td>{{ product.gpu }}</td></tr>
                  {% endif %}
                  {% if product.ram %}
                  <tr><td><strong>–û–ø–µ—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–º'—è—Ç—å</strong></td><td>{{ product.ram }}</td></tr>
                  {% endif %}
                  {% if product.rom %}
                  <tr><td><strong>–í–Ω—É—Ç—Ä—ñ—à–Ω—è –ø–∞–º'—è—Ç—å</strong></td><td>{{ product.rom }}</td></tr>
                  {% endif %}
                  <tr><td><strong>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ microSD</strong></td><td>{{ "–¢–∞–∫" if product.microsd_support else "–ù—ñ" }}</td></tr>
                </table>
              </div>

              <!-- –ö–∞–º–µ—Ä–∞ –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–µ -->
              <div class="col-md-6">
                <h5 class="text-primary">üì∏ –ö–∞–º–µ—Ä–∞</h5>
                <table class="table table-sm">
                  {% if product.main_camera %}
                  <tr><td><strong>–û—Å–Ω–æ–≤–Ω–∞ –∫–∞–º–µ—Ä–∞</strong></td><td>{{ product.main_camera }}</td></tr>
                  {% endif %}
                  {% if product.selfie_camera %}
                  <tr><td><strong>–§—Ä–æ–Ω—Ç–∞–ª—å–Ω–∞ –∫–∞–º–µ—Ä–∞</strong></td><td>{{ product.selfie_camera }}</td></tr>
                  {% endif %}
                  <tr><td><strong>–û–ø—Ç–∏—á–Ω–∞ —Å—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è</strong></td><td>{{ "–¢–∞–∫" if product.optical_stabilization else "–ù—ñ" }}</td></tr>
                  {% if product.video_recording %}
                  <tr><td><strong>–í—ñ–¥–µ–æ–∑–∞–ø–∏—Å</strong></td><td>{{ product.video_recording }}</td></tr>
                  {% endif %}
                </table>

                <h5 class="text-primary mt-4">üîã –ê–∫—É–º—É–ª—è—Ç–æ—Ä</h5>
                <table class="table table-sm">
                  {% if product.battery_capacity %}
                  <tr><td><strong>–Ñ–º–Ω—ñ—Å—Ç—å –∞–∫—É–º—É–ª—è—Ç–æ—Ä–∞</strong></td><td>{{ product.battery_capacity }}</td></tr>
                  {% endif %}
                  {% if product.fast_charge %}
                  <tr><td><strong>–®–≤–∏–¥–∫–∞ –∑–∞—Ä—è–¥–∫–∞</strong></td><td>{{ product.fast_charge }}</td></tr>
                  {% endif %}
                  <tr><td><strong>–ë–µ–∑–¥—Ä–æ—Ç–æ–≤–∞ –∑–∞—Ä—è–¥–∫–∞</strong></td><td>{{ "–¢–∞–∫" if product.wireless_charge else "–ù—ñ" }}</td></tr>
                  <tr><td><strong>–ó–≤–æ—Ä–æ—Ç–Ω–∞ –∑–∞—Ä—è–¥–∫–∞</strong></td><td>{{ "–¢–∞–∫" if product.reverse_charge else "–ù—ñ" }}</td></tr>
                </table>

                <h5 class="text-primary mt-4">üåê –ó–≤'—è–∑–æ–∫</h5>
                <table class="table table-sm">
                  <tr><td><strong>–ü—ñ–¥—Ç—Ä–∏–º–∫–∞ 5G</strong></td><td>{{ "–¢–∞–∫" if product.support_5g else "–ù—ñ" }}</td></tr>
                  {% if product.wifi_version %}
                  <tr><td><strong>Wi-Fi</strong></td><td>{{ product.wifi_version }}</td></tr>
                  {% endif %}
                  {% if product.bluetooth_version %}
                  <tr><td><strong>Bluetooth</strong></td><td>{{ product.bluetooth_version }}</td></tr>
                  {% endif %}
                  <tr><td><strong>GPS</strong></td><td>{{ "–¢–∞–∫" if product.gps else "–ù—ñ" }}</td></tr>
                  <tr><td><strong>NFC</strong></td><td>{{ "–¢–∞–∫" if product.nfc else "–ù—ñ" }}</td></tr>
                  <tr><td><strong>–Ü–ß-–ø–æ—Ä—Ç</strong></td><td>{{ "–¢–∞–∫" if product.ir_port else "–ù—ñ" }}</td></tr>
                </table>

                <h5 class="text-primary mt-4">üìû SIM</h5>
                <table class="table table-sm">
                  {% if product.sim_type %}
                  <tr><td><strong>–¢–∏–ø SIM</strong></td><td>{{ product.sim_type }}</td></tr>
                  {% endif %}
                  {% if product.sim_count %}
                  <tr><td><strong>–ö—ñ–ª—å–∫—ñ—Å—Ç—å SIM</strong></td><td>{{ product.sim_count }}</td></tr>
                  {% endif %}
                  <tr><td><strong>VoLTE</strong></td><td>{{ "–¢–∞–∫" if product.volte_support else "–ù—ñ" }}</td></tr>
                </table>

                <h5 class="text-primary mt-4">üîê –ë–µ–∑–ø–µ–∫–∞</h5>
                <table class="table table-sm">
                  {% if product.fingerprint_sensor %}
                  <tr><td><strong>–°–∫–∞–Ω–µ—Ä –≤—ñ–¥–±–∏—Ç–∫–∞</strong></td><td>{{ product.fingerprint_sensor }}</td></tr>
                  {% endif %}
                  <tr><td><strong>–†–æ–∑–ø—ñ–∑–Ω–∞–≤–∞–Ω–Ω—è –æ–±–ª–∏—á—á—è</strong></td><td>{{ "–¢–∞–∫" if product.face_unlock else "–ù—ñ" }}</td></tr>
                </table>

                <h5 class="text-primary mt-4">üèóÔ∏è –ö–æ—Ä–ø—É—Å</h5>
                <table class="table table-sm">
                  {% if product.body_material %}
                  <tr><td><strong>–ú–∞—Ç–µ—Ä—ñ–∞–ª –∫–æ—Ä–ø—É—Å—É</strong></td><td>{{ product.body_material }}</td></tr>
                  {% endif %}
                  {% if product.ip_protection %}
                  <tr><td><strong>IP-–∑–∞—Ö–∏—Å—Ç</strong></td><td>{{ product.ip_protection }}</td></tr>
                  {% endif %}
                  {% if product.dimensions %}
                  <tr><td><strong>–†–æ–∑–º—ñ—Ä–∏</strong></td><td>{{ product.dimensions }}</td></tr>
                  {% endif %}
                  {% if product.weight %}
                  <tr><td><strong>–í–∞–≥–∞</strong></td><td>{{ product.weight }}</td></tr>
                  {% endif %}
                </table>

                {% if product.accessories or product.interfaces %}
                <h5 class="text-primary mt-4">üì¶ –î–æ–¥–∞—Ç–∫–æ–≤–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è</h5>
                <table class="table table-sm">
                  {% if product.accessories %}
                  <tr><td><strong>–ö–æ–º–ø–ª–µ–∫—Ç–∞—Ü—ñ—è</strong></td><td>{{ product.accessories }}</td></tr>
                  {% endif %}
                  {% if product.interfaces %}
                  <tr><td><strong>–Ü–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏</strong></td><td>{{ product.interfaces }}</td></tr>
                  {% endif %}
                </table>
                {% endif %}
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -->
<div class="row mt-5">
  <div class="col-12">
    <div class="recommendation-block my-4">
      <h3>–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó –¥–ª—è –≤–∞—Å</h3>
      <div class="d-flex align-items-center">
        <button class="btn btn-outline-secondary btn-sm me-2" id="prevRecDetail">‚ü®</button>
        <div class="recommendation-carousel flex-grow-1 d-flex" 
             id="recCarouselDetail" 
             style="gap: 15px; overflow-x: auto; scroll-behavior: smooth; scrollbar-width: thin;">
          {% for rec in recommendations %}
            <div class="rec-card border rounded p-2 text-center" style="min-width: 180px; flex-shrink: 0;">
              <a href="{{ url_for('product_detail', product_id=rec.id) }}" data-product-id="{{ rec.id }}">
                <img src="{{ rec.image_url }}" alt="{{ rec.title }}" style="max-height: 120px; object-fit: contain; width: 100%;">
              </a>
              <div class="rec-card-body mt-2">
                <h6>
                  <a href="{{ url_for('product_detail', product_id=rec.id) }}" data-product-id="{{ rec.id }}">{{ rec.title }}</a>
                </h6>
                <div class="price">{{ rec.price }} –≥—Ä–Ω</div>
                <div class="rec-actions mt-2 d-flex justify-content-between">
                  <button class="btn btn-outline-danger btn-sm wishlist-btn" data-product-id="{{ rec.id }}" data-source="recCarouselDetail">‚ù§Ô∏è</button>
                  <button class="btn btn-outline-primary btn-sm cart-btn" data-product-id="{{ rec.id }}" data-source="recCarouselDetail">üõí</button>
                </div>
              </div>
            </div>
          {% endfor %}
        </div>
        <button class="btn btn-outline-secondary btn-sm ms-2" id="nextRecDetail">‚ü©</button>
      </div>
    </div>
  </div>
</div>


  <!-- –ö–Ω–æ–ø–∫–∞ –≤–æ–∑–≤—Ä–∞—Ç–∞ -->
  <div class="row mt-4 mb-4">
    <div class="col-12">
      <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</a>
    </div>
  </div>
</div>

<!-- JavaScript –¥–ª—è –∫–Ω–æ–ø–æ–∫ –∫–æ—Ä–∑–∏–Ω—ã –∏ –≤–∏—à–ª–∏—Å—Ç–∞ -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // –î–∞–Ω–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞
  const serverDataElement = document.getElementById('server-data');
  let loggedInUser = null;
  if (serverDataElement) {
    const serverData = JSON.parse(serverDataElement.textContent);
    loggedInUser = serverData.user;
  }

  async function logRecommendationEvent(productId, eventType, source = "product_page") {
    if (!loggedInUser || !loggedInUser.id) return;
    try {
      await fetch("/log_recommendation_event", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          user_id: loggedInUser.id,
          product_id: productId,
          event_type: eventType,
          source: source
        })
      });
      console.log(`üìå Product page log: ${eventType} ‚Üí ${productId}`);
    } catch (err) {
      console.error("‚ùå Product page log error:", err);
    }
  }

  // –ö–ª—ñ–∫ –ø–æ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è–º (–ø–æ—Å–∏–ª–∞–Ω–Ω—è –Ω–∞ —Ç–æ–≤–∞—Ä)
  document.addEventListener('click', async function(e) {
    const productLink = e.target.closest('.recommendation-block a[href*="/product/"]');
    if (productLink) {
      const productId = parseInt(productLink.getAttribute('data-product-id'));
      if (productId && loggedInUser) {
        await logRecommendationEvent(productId, "clicked", "product_page");
      }
    }
  });

  // –ö–ª—ñ–∫ –ø–æ ‚ù§Ô∏è —É –±–ª–æ—Ü—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π
  document.addEventListener('click', async function(e) {
    if (e.target.closest('.recommendation-block .wishlist-btn')) {
      const btn = e.target.closest('.wishlist-btn');
      const productId = parseInt(btn.getAttribute('data-product-id'));
      await logRecommendationEvent(productId, "wishlisted", "product_page");
    }
  });

  // –ö–ª—ñ–∫ –ø–æ üõí —É –±–ª–æ—Ü—ñ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ–π
  document.addEventListener('click', async function(e) {
    if (e.target.closest('.recommendation-block .cart-btn')) {
      const btn = e.target.closest('.cart-btn');
      const productId = parseInt(btn.getAttribute('data-product-id'));
      await logRecommendationEvent(productId, "added_to_cart", "product_page");
    }
  });

  // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –∫–æ—Ä–∑–∏–Ω—É (–æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
  document.addEventListener('click', async function(e) {
    if (e.target.classList.contains('cart-btn') || e.target.closest('.cart-btn')) {
      e.preventDefault();
      const btn = e.target.classList.contains('cart-btn') ? e.target : e.target.closest('.cart-btn');
      const productId = btn.getAttribute('data-product-id');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞
      if (btn.disabled) {
        return;
      }
      
      try {
        const response = await fetch('/add-to-cart', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ product_id: parseInt(productId), quantity: 1 })
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('‚úÖ ' + data.message);
          // –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
          btn.innerHTML = 'üõí –í–∂–µ –≤ –∫–æ—à–∏–∫—É';
          btn.disabled = true;
        } else {
          if (response.status === 401) {
            alert('‚ùå –î–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –¥–æ –∫–æ—à–∏–∫–∞ –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è!');
          } else {
            alert('‚ùå ' + data.error);
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');
      }
    }

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è –≤ –≤–∏—à–ª–∏—Å—Ç (–æ—Å–Ω–æ–≤–Ω—ã—Ö –∫–Ω–æ–ø–æ–∫ –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ)
    if (e.target.classList.contains('wishlist-btn') || e.target.closest('.wishlist-btn')) {
      e.preventDefault();
      const btn = e.target.classList.contains('wishlist-btn') ? e.target : e.target.closest('.wishlist-btn');
      const productId = btn.getAttribute('data-product-id');
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º, –Ω–µ –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω–∞ –ª–∏ –∫–Ω–æ–ø–∫–∞
      if (btn.disabled) {
        return;
      }
      
      try {
        const response = await fetch('/add-to-wishlist', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ product_id: parseInt(productId) })
        });
        
        const data = await response.json();
        
        if (data.success) {
          alert('‚úÖ ' + data.message);
          // –ú–µ–Ω—è–µ–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ –∫–Ω–æ–ø–∫–∏
          btn.innerHTML = '‚ù§Ô∏è –í –≤—ñ—à–ª–∏—Å—Ç—ñ';
          btn.disabled = true;
        } else {
          if (response.status === 401) {
            alert('‚ùå –î–ª—è –¥–æ–¥–∞–≤–∞–Ω–Ω—è —Ç–æ–≤–∞—Ä—ñ–≤ –¥–æ –≤—ñ—à–ª–∏—Å—Ç—É –Ω–µ–æ–±—Ö—ñ–¥–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑—É–≤–∞—Ç–∏—Å—è!');
          } else {
            alert('‚ùå ' + data.error);
          }
        }
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ –≤ –≤–∏—à–ª–∏—Å—Ç:', error);
        alert('‚ùå –ü–æ–º–∏–ª–∫–∞ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ —Å–µ—Ä–≤–µ—Ä–∞');
      }
    }
  });
  
  // –ö–∞—Ä—É—Å–µ–ª—å —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π
    const carousel = document.getElementById('recCarouselDetail');
    let scrollAmount = 0;
    const cardWidth = 200;

    document.getElementById('prevRecDetail').addEventListener('click', () => {
      carousel.scrollBy({ left: -cardWidth, behavior: 'smooth' });
    });
    document.getElementById('nextRecDetail').addEventListener('click', () => {
      carousel.scrollBy({ left: cardWidth, behavior: 'smooth' });
    });
});
</script>
{% endblock %}