{% extends "base.html" %}

{% block title %}–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–∫—É–ø–æ–∫ - SmartShop{% endblock %}

{% block content %}
<div class="container py-4">
  <h2 class="mb-4">üì¶ –Ü—Å—Ç–æ—Ä—ñ—è –º–æ—ó—Ö –ø–æ–∫—É–ø–æ–∫</h2>
  
  {% if purchases %}
    <div class="table-responsive">
      <table class="table table-hover">
        <thead>
          <tr>
            <th>–î–∞—Ç–∞</th>
            <th>–§–æ—Ç–æ</th>
            <th>–¢–æ–≤–∞—Ä</th>
            <th>–ö—ñ–ª—å–∫—ñ—Å—Ç—å</th>
            <th>–¶—ñ–Ω–∞ –∑–∞ –æ–¥.</th>
            <th>–°—É–º–∞</th>
          </tr>
        </thead>
        <tbody>
          {% for purchase in purchases %}
          <tr>
            <td>{{ purchase.purchase_date.strftime('%d.%m.%Y %H:%M') }}</td>
            <td>
              <img src="{{ purchase.image_url }}" alt="{{ purchase.title }}" style="width: 50px; height: 50px; object-fit: contain;">
            </td>
            <td>
              <a href="{{ url_for('product_detail', product_id=purchase.product_id) }}" class="text-decoration-none">
                {{ purchase.title }}
              </a>
            </td>
            <td>{{ purchase.quantity }}</td>
            <td>{{ '{:.2f}'.format(purchase.price) }} –≥—Ä–Ω</td>
            <td><strong>{{ '{:.2f}'.format(purchase.price * purchase.quantity) }} –≥—Ä–Ω</strong></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    
    <!-- –ü—ñ–¥—Å—É–º–∫–æ–≤–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ -->
    <div class="card mt-4">
      <div class="card-body">
        <h5 class="card-title">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ–∫—É–ø–æ–∫</h5>
        <p class="card-text">
          –í—Å—å–æ–≥–æ –∑–∞–º–æ–≤–ª–µ–Ω—å: <strong>{{ purchases|length }}</strong><br>
          –ó–∞–≥–∞–ª—å–Ω–∞ —Å—É–º–∞: <strong>{{ '{:.2f}'.format(purchases|sum(attribute='price')) }} –≥—Ä–Ω</strong>
        </p>
      </div>
    </div>
  {% else %}
    <div class="alert alert-info" role="alert">
      <h4 class="alert-heading">–Ü—Å—Ç–æ—Ä—ñ—è –ø–æ–∫—É–ø–æ–∫ –ø–æ—Ä–æ–∂–Ω—è</h4>
      <p>–í–∏ —â–µ –Ω–µ –∑–¥—ñ–π—Å–Ω–∏–ª–∏ –∂–æ–¥–Ω–æ—ó –ø–æ–∫—É–ø–∫–∏.</p>
      <hr>
      <a href="{{ url_for('index') }}" class="btn btn-primary">–ü–µ—Ä–µ–π—Ç–∏ –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</a>
    </div>
  {% endif %}
  
  <div class="mt-4">
    <a href="{{ url_for('index') }}" class="btn btn-secondary">‚Üê –ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—è –¥–æ –∫–∞—Ç–∞–ª–æ–≥—É</a>
  </div>
</div>
{% endblock %}